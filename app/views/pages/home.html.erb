<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6 text-center">
      <!-- Header -->
      <h1 class="display-5 fw-bold mb-3" style="letter-spacing: -0.03em;">
        Analysez vos frais bancaires
        <br>
        en 30 secondes
      </h1>

      <p class="lead text-muted mb-5">
        Déposez votre relevé PDF pour détecter automatiquement les frais cachés
        et les économies possibles.
      </p>

      <!-- Drop Zone -->
      <div class="file-upload-wrapper mb-4">
        <label
          for="file-input"
          class="upload-label upload-hero w-100 shadow-sm border-2"
          id="dropZone"
          style="border-style: dashed;"
        >
          <div class="text-center py-4">
            <div class="mb-4">
              <div
                class="
                  d-inline-flex align-items-center justify-content-center
                  bg-primary bg-opacity-10 rounded-circle
                "
                style="width: 80px; height: 80px;"
              >
                <i class="fas fa-file-invoice text-primary fa-2x"></i>
              </div>
            </div>

            <h5 class="fw-bold mb-2">Scanner mon relevé</h5>

            <p class="text-muted small mb-0">
              Glissez-déposez votre PDF ou cliquez pour parcourir
            </p>
          </div>
        </label>

        <input
          id="file-input"
          type="file"
          accept="application/pdf,*"
          style="display: none;"
        >
      </div>

      <!-- Reassurance -->
      <div class="row g-3 text-center mt-4 mb-5">
        <div class="col-4">
          <div class="p-2">
            <i class="fas fa-lock text-success mb-2 fs-5"></i>
            <p class="small text-muted fw-semibold mb-0">100% Sécurisé</p>
          </div>
        </div>

        <div class="col-4">
          <div class="p-2">
            <i class="fas fa-eye-slash text-primary mb-2 fs-5"></i>
            <p class="small text-muted fw-semibold mb-0">Confidentiel</p>
          </div>
        </div>

        <div class="col-4">
          <div class="p-2">
            <i class="fas fa-trash-alt text-muted mb-2 fs-5"></i>
            <p class="small text-muted fw-semibold mb-0">Suppression auto</p>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loading-state" class="d-none mt-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Importation en cours...</span>
        </div>

        <p class="text-muted mt-2 fw-medium">Analyse sécurisée en cours...</p>
      </div>
    </div>
  </div>
</div>

<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('file-input');
  const loadingState = document.getElementById('loading-state');

  // Click to upload
  fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
      handleFiles(e.target.files);
    }
  });

  // Drag & Drop
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleFiles(files);
    }
  });

  function handleFiles(files) {
    const file = files[0];
    console.log("Fichier déposé :", file.name, file.size, file.type);

    // Show loading state
    dropZone.classList.add('d-none');
    loadingState.classList.remove('d-none');

    // Simulate PDF import
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

    fetch('<%= import_pdf_statements_path %>', {
      method: 'POST',
      headers: {
        'X-CSRF-Token': csrfToken,
        'Accept': 'text/html'
      }
    })
    .then(response => {
      if (response.redirected) {
        window.location.href = response.url;
      } else {
        return response.text().then(html => {
          document.body.innerHTML = html;
        });
      }
    })
    .catch(error => {
      console.error('Erreur import:', error);
      alert('Erreur lors de l\'importation. Veuillez réessayer.');
      dropZone.classList.remove('d-none');
      loadingState.classList.add('d-none');
    });
  }
</script>
