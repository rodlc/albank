<div
  class="container d-flex flex-column justify-content-center pt-4 pt-lg-0"
  style="min-height: calc(100vh - 100px);"
>
  <div class="row justify-content-center w-100">
    <div class="col-md-8 col-lg-6 text-center">
      <!-- Header -->
      <h1 class="display-5 fw-bold mb-3" style="letter-spacing: -0.03em;">
        <span class="underline-cyan">Prot√©gez votre argent</span>
        <br>
        des fraudes et abus
      </h1>

      <p class="lead text-muted mb-5">
        D√©posez votre relev√© PDF pour d√©tecter automatiquement les faux d√©bits,
        abonnements frauduleux et anomalies.
      </p>

      <!-- Drop Zone -->
      <div class="file-upload-wrapper mb-4">
        <label
          for="file-input"
          class="upload-label upload-hero w-100 shadow-sm border-2 bg-white"
          id="dropZone"
          style="border-style: dashed; cursor: pointer; transition: all 0.2s ease;"
        >
          <div class="text-center py-5">
            <div class="mb-3"><span style="font-size: 4rem;">üìÑ</span></div>

            <h5 class="fw-bold mb-2">Lancer l'enqu√™te</h5>

            <p class="text-muted small mb-0">
              Glissez-d√©posez votre PDF pour d√©marrer l'analyse
            </p>
          </div>
        </label>

        <input
          id="file-input"
          type="file"
          accept="application/pdf,*"
          style="display: none;"
        >
      </div>

      <!-- Reassurance -->
      <div class="row g-3 text-center mt-4 mb-5">
        <div class="col-4">
          <div class="p-2">
            <div class="fs-2 mb-2">üîí</div>
            <p class="small text-muted fw-semibold mb-0">100% S√©curis√©</p>
          </div>
        </div>

        <div class="col-4">
          <div class="p-2">
            <div class="fs-2 mb-2">üôà</div>
            <p class="small text-muted fw-semibold mb-0">Confidentiel</p>
          </div>
        </div>

        <div class="col-4">
          <div class="p-2">
            <div class="fs-2 mb-2">üóëÔ∏è</div>
            <p class="small text-muted fw-semibold mb-0">Suppression auto</p>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loading-state" class="d-none mt-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Importation en cours...</span>
        </div>

        <p class="text-muted mt-2 fw-medium">Analyse s√©curis√©e en cours...</p>
      </div>
    </div>
  </div>
</div>

<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('file-input');
  const loadingState = document.getElementById('loading-state');

  // Click to upload
  fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
      handleFiles(e.target.files);
    }
  });

  // Drag & Drop
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
    dropZone.style.borderColor = '#000091';
    dropZone.style.backgroundColor = '#F5F5FE';
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('dragover');
    dropZone.style.borderColor = '';
    dropZone.style.backgroundColor = '';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    dropZone.style.borderColor = '';
    dropZone.style.backgroundColor = '';
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleFiles(files);
    }
  });

  function handleFiles(files) {
    const file = files[0];
    console.log("Fichier d√©pos√© :", file.name, file.size, file.type);

    // Show loading state
    dropZone.classList.add('d-none');
    loadingState.classList.remove('d-none');

    // Simulate PDF import
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

    fetch('<%= import_pdf_statements_path %>', {
      method: 'POST',
      headers: {
        'X-CSRF-Token': csrfToken,
        'Accept': 'text/html'
      }
    })
    .then(response => {
      if (response.redirected) {
        window.location.href = response.url;
      } else {
        return response.text().then(html => {
          document.body.innerHTML = html;
        });
      }
    })
    .catch(error => {
      console.error('Erreur import:', error);
      alert('Erreur lors de l\'importation. Veuillez r√©essayer.');
      dropZone.classList.remove('d-none');
      loadingState.classList.add('d-none');
    });
  }
</script>
