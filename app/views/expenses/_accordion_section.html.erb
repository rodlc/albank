<%
  config = result_type_config(result_type)
  section_id = "section-#{result_type}-#{index}"
  show_class = index == 0 ? "show" : ""
  totals = section_totals(expenses)
%>

<div class="accordion-item accordion-<%= config[:color] %>">
  <h2 class="accordion-header">
    <button
      class="accordion-button <%= 'collapsed' unless index == 0 %>"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#<%= section_id %>"
      aria-expanded="<%= index == 0 ? 'true' : 'false' %>"
      aria-controls="<%= section_id %>"
      aria-label="<%= config[:label] %> : <%= expenses.count %> dépense(s), total <%= number_to_currency(totals[:total], unit: '€', precision: 0, separator: ',', delimiter: ' ') %><%= ", économies potentielles #{number_to_currency(totals[:savings], unit: '€', precision: 0, separator: ',', delimiter: ' ')}" if totals[:savings] > 0 %>"
    >
      <div class="d-flex align-items-center gap-2 flex-grow-1">
        <span class="section-emoji"><%= config[:emoji] %></span>
        <span class="section-label"><%= config[:label] %></span>
        <span class="badge badge-<%= config[:color] %>"><%= expenses.count %></span>
      </div>
      <span class="section-totals ms-auto">
        <span class="<%= 'text-danger' if result_type == :danger %>">
          <%= number_to_currency(totals[:total], unit: "€", precision: 0, separator: ",", delimiter: " ") %>
        </span>
        <% if totals[:savings] > 0 %>
          <span class="text-primary"> · <%= number_to_currency(totals[:savings], unit: "€", precision: 0, separator: ",", delimiter: " ") %></span>
        <% end %>
      </span>
      <span class="section-action d-none d-md-inline">Voir</span>
    </button>
  </h2>

  <div
    id="<%= section_id %>"
    class="accordion-collapse collapse <%= show_class %>"
    data-bs-parent="#expensesAccordion"
  >
    <div class="accordion-body">
      <% group_expenses(expenses).each do |expense| %>
        <%= render "expenses/expense_row", expense: expense, statement: statement %>
      <% end %>
    </div>
  </div>
</div>
