<% opportunity = expense.opportunities.first %>

<div class="expense-row">
  <div class="row align-items-center">
    <!-- Icon + Category -->
    <div class="col-12 col-md-3 d-flex align-items-center mb-3 mb-md-0">
      <div class="expense-icon me-3">
        <%= category_emoji(expense.category) %>
      </div>

      <div>
        <div class="expense-category">
          <%= expense.category.name %>
        </div>

        <small class="expense-sublabel">
          Pr√©l√®vement mensuel
        </small>
      </div>
    </div>

    <!-- Label -->
    <div class="col-12 col-md-3 mb-2 mb-md-0">
      <span class="expense-label">
        <%= expense.label %>
      </span>
    </div>

    <!-- Amount + Savings -->
    <div class="col-6 col-md-2 text-md-end mb-2 mb-md-0">
      <div class="expense-amount">
        <%= number_to_currency(expense.subtotal, unit: "‚Ç¨", precision: 2) %>
      </div>

      <% if opportunity&.opportunity? %>
        <div class="expense-savings">
          -<%= number_to_currency(opportunity.savings, unit: "‚Ç¨", precision: 0) %>
        </div>
      <% end %>
    </div>

    <!-- Status Badge (hidden on mobile) -->
    <div class="col-6 col-md-2 text-end d-none d-md-block">
      <% if opportunity %>
        <div class="expense-status">
          <span
            class=\"
              badge bg-<%= case opportunity.status
              when 'pending' then 'warning'
              when 'contacted' then 'info'
              when 'completed' then 'success'
              end %>
            \"
          >
            <%= opportunity.status.humanize %>
          </span>
        </div>
      <% end %>
    </div>

    <!-- Action -->
    <div class="col-6 col-md-2 text-end">
      <div class="expense-action">
        <% if opportunity %>
          <% if opportunity.completed? %>
            <div class="btn btn-sm disabled border-0 text-success">
              <span>üéâ</span> Optimis√©
            </div>
          <% elsif opportunity.contacted? %>
            <div class="btn btn-sm disabled border-0 text-primary">
              <span>‚úÖ</span> Contact√©
            </div>
          <% elsif opportunity.danger? %>
            <%= link_to statement_expense_opportunity_path(statement, expense, opportunity),
                        class: "btn btn-danger btn-sm text-white" do %>
              <span>üö®</span> Alerter
            <% end %>
          <% else %>
            <%= link_to statement_expense_opportunity_path(statement, expense, opportunity),
                        class: "btn btn-primary btn-sm text-white" do %>
              <span>‚ö°</span> Agir
            <% end %>
          <% end %>
        <% else %>
          <div class="btn btn-sm disabled border-0 text-muted opacity-75">
            <span>‚òëÔ∏è</span> Optimis√©
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
