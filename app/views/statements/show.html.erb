<div class="container mt-4">
  <%= link_to "‚Üê Retour aux relev√©s", statements_path, class: "btn btn-link" %>

  <h1>Relev√© du <%= @statement.date.strftime("%B %Y") %></h1>

  <p class="lead">Total: <strong><%= @expenses.sum(&:subtotal) %>‚Ç¨</strong></p>

  <% if @expenses.any? %>
    <h3 class="mt-4">D√©penses par cat√©gorie</h3>
    <div class="row">
      <% @expenses.each do |expense| %>
        <% category_emoji = case expense.category.name
             when /√©lectricit√©|gaz|√©nergie/i then "‚ö°"
             when /internet|box|fibre/i then "üì°"
             when /assurance|habitation|auto/i then "üõ°Ô∏è"
             when /banque|frais/i then "üè¶"
             else "üìã"
           end %>
        <div class="col-md-6 mb-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                <span class="me-2"><%= category_emoji %></span>
                <%= expense.category.name %>
              </h5>

              <p class="card-text"><strong><%= expense.subtotal %>‚Ç¨</strong></p>

              <% if expense.opportunities.any? %>
                <p class="text-success">
                  <%= expense.opportunities.count %> opportunit√©(s) d'√©conomie
                </p>
                <% expense.opportunities.each do |opportunity| %>
                  <%= link_to "Voir l'opportunit√©",
                      statement_expense_opportunity_path(@statement, expense, opportunity),
                      class: "btn btn-sm btn-outline-primary" %>
                <% end %>
              <% else %>
                <p class="text-muted">Aucune opportunit√© d√©tect√©e</p>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info">
      Aucune d√©pense dans ce relev√©.
    </div>
  <% end %>
</div>
